<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.5/angular.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>

<script type="text/javascript">
	var app = angular.module("App", []);


	app.controller("AppCtrl", function($scope, $http){
	  $scope.to_vote_vm = function(vote){
				vote.cast = function () {
					$http.post('/votes/cast',{id:vote.id, voter:_(location.search).toQueryParams()["user"]
})
						.success(function(){vote.count++;});
				};
	  };

	  data = {
	  	flexevent: {
	  		address: "1234 main st",
	  		created_at: "2013-04-01T06:10:54Z",
	  		event_time: "2000-01-01T06:10:00Z",
	  		id: 1,
	  		location: "Improving Enterprises",
	  		name: "Hack Club",
	  		updated_at: "2013-04-01T06:10:54Z",
	  		voting_cutoff: "2013-04-01T06:10:00Z"
	  	},
	  	votes: [
	  	{
	  		upvotes: 8,
	  		downvotes: 3,
	  		created_at: "2013-04-09T00:39:27Z",
	  		event_date: "2013-04-01",
	  		event_id: 1,
	  		id: 1,
	  		updated_at: "2013-04-09T00:39:27Z"
	  	},
	  	{
	  		upvotes: 4,
	  		downvotes: 8,
	  		created_at: "2013-04-09T00:39:47Z",
	  		event_date: "2013-04-02",
	  		event_id: 1,
	  		id: 2,
	  		updated_at: "2013-04-09T00:39:47Z"
	  	}
	  	]
	  };

	  $scope.flexevent = data.flexevent;
	  $scope.flexevent.votes = data.votes;
	});
</script>

<div id="main" ng-app="App" ng-controller="AppCtrl">
	<div class="row span12">
		<h3>{{flexevent.name}}</h3>
		<ul>
			<li>{{flexevent.location}}</li>
			<li>{{flexevent.address}}</li>
			<li>{{flexevent.event_time}}</li>
			<li>{{flexevent.voting_cutoff}}</li>
		</ul>
	</div>
	<div class="row span12">
	<h3>Voting Options</h3>
	<div class="votes row span12" ng-repeat="vote in flexevent.votes">
		<h4>{{vote.event_date}}</h4	>
		<p> total upvotes: {{vote.upvotes}} <a href="#" class="icon-thumbs-up"></a></p>
		<p> total downvotes: {{vote.downvotes}} <a href="#" class="icon-thumbs-down"></a></p>
	</div>
	</div>
</div>